<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Accel Display</title>
  <style>
    body,html{margin:0;height:100vh;overflow:hidden;background:#000;font-family:system-ui,sans-serif;color:white}
    #tilesContainer{position:relative;width:100%;height:100%}
    .tile{position:absolute;box-sizing:border-box;overflow:hidden;user-select:none;transition:all .6s}
    .tile img,.tile video,.tile iframe{width:100%;height:100%;object-fit:cover;display:block}
    .tile video{background:#000}
    .marquee {
  white-space: nowrap;
  animation: marquee 15s linear infinite;
}
@keyframes marquee {
  0% { transform: translateX(100%); }
  100% { transform: translateX(-100%); }
}
  </style>
</head>
<body>

  <!-- THIS LINE WAS MISSING — THIS IS WHY IT WAS BLACK -->
  <div id="tilesContainer"></div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxPQCmFSUG_9W2N62hqo7tPI6M_T9GCFD2FveCnA8uOYZ0lHLmSNMQDIufXP03vmybZfg/exec";

    async function loadTiles() {
      try {
        const res = await fetch(API_URL + "?t=" + Date.now());
        if (!res.ok) throw new Error("HTTP " + res.status);
        const tiles = await res.json();

        if (!Array.isArray(tiles) || tiles.length === 0) {
          document.getElementById("tilesContainer").innerHTML = "<div style='position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:48px;color:#f66'>No tiles returned</div>";
          return;
        }

        const container = document.getElementById("tilesContainer");
        container.innerHTML = "";

        tiles.forEach(t => {
          if (t.visible === false || t.visible === "FALSE") return;

          const tile = document.createElement("div");
          tile.className = "tile";

          tile.style.left   = t.x || "500%";
          tile.style.top    = t.y || "0%";
          tile.style.width  = t.width || "30%";
          tile.style.height = t.height || "20%";
          tile.style.background = t.bgcolor || "rgba(0,0,0,0.6)";
          tile.style.color = t.textcolor || "white";
          tile.style.fontSize = t.fontsize || "24px";
          tile.style.fontWeight = t.bold === "yes" ? "bold" : "normal";
          tile.style.textAlign = t.align || "center";
          tile.style.padding = t.padding || "20px";
          tile.style.borderRadius = t.radius || "20px";
          tile.style.boxShadow = t.shadow || "0 8px 32px rgba(0,0,0,0.6)";
          tile.style.opacity = t.opacity ?? 1;
          tile.style.transform = t.rotate ? `rotate(${t.rotate}deg)` : "";
          tile.style.zIndex = t.zindex || "1";
          tile.style.display = "flex";
          tile.style.alignItems = "center";
          tile.style.justifyContent = "center";
          tile.style.textShadow = "0 2px 8px rgba(0,0,0,0.8)";

          if (t.type === "text" && t.content) {
            tile.innerHTML = t.content.replace(/\\n/g, "<br>");
          }
          else if (t.type === "image" && t.content) {
            tile.innerHTML = `<img src="${t.content}" alt="">`;
          }
          else if (t.type === "video" && t.content) {
            if (t.content.match(/\.(mp4|webm|mov|ogg)/i)) {
              tile.innerHTML = `<video autoplay muted loop playsinline><source src="${t.content}"></video>`;
            } else if (t.content.includes("vimeo")) {
              const id = t.content.match(/vimeo.*\/(\d+)/)?.[1];
              if (id) {
                tile.innerHTML = `<iframe src="https://player.vimeo.com/video/${id}?autoplay=1&loop=1&muted=1&background=1&title=0&byline=0&portrait=0&pip=0&autoplay=1&muted=1#t=0.0001" allow="autoplay; fullscreen" allowfullscreen></iframe>`;
              }
            }
          }
          else if (t.type === "clock") {
            tile.innerHTML = `<div style="font-size:3em;font-weight:bold">${new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</div>`;
            setInterval(() => {
              tile.querySelector("div")?.replaceWith(tile.querySelector("div").cloneNode(true));
              tile.querySelector("div").textContent = new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
            }, 1000);
          }
else if (t.type === "clock") {
  tile.innerHTML = `<div style="font-size:3em;font-weight:bold">${new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</div>`;
  setInterval(() => {
    tile.querySelector("div")?.replaceWith(tile.querySelector("div").cloneNode(true));
    tile.querySelector("div").textContent = new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
  }, 1000);
}
else if (t.type === "shape") {
  tile.innerHTML = "";
  // color, radius, opacity already handled by your existing style code
}
else if (t.type === "iframe" && t.content) {
  tile.innerHTML = `<iframe src="${t.content}" style="width:100%;height:100%;border:0;"></iframe>`;
}
else if (t.type === "date") {
  tile.innerHTML = new Date().toLocaleDateString(undefined, {
    weekday: 'long',
    month: 'long',
    day: 'numeric',
    year: 'numeric'
  });
}
else if (t.type === "weather" && t.content) {
  fetch(`https://wttr.in/${encodeURIComponent(t.content)}?format=3`)
    .then(r => r.text())
    .then(txt => { tile.innerHTML = txt; })
    .catch(() => { tile.innerHTML = "Weather unavailable"; });
}
else if (t.type === "rss" && t.content) {
  fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(t.content)}`)
    .then(r => r.json())
    .then(feed => {
      if (!feed.items) { tile.innerHTML = "RSS unavailable"; return; }
      const headlines = feed.items.map(i => i.title).join(" • ");
      tile.innerHTML = `<div class="rssTicker">${headlines}</div>`;
      tile.querySelector(".rssTicker").style.whiteSpace = "nowrap";
      tile.querySelector(".rssTicker").style.animation = "scrollLeft 30s linear infinite";
    })
    .catch(() => { tile.innerHTML = "RSS error"; });
}
else if (t.type === "quote") {
  fetch("https://api.quotable.io/random")
    .then(r => r.json())
    .then(q => { tile.innerHTML = `"${q.content}" — ${q.author}`; })
    .catch(() => { tile.innerHTML = "Quote unavailable"; });
}
else if (t.type === "countdown" && t.content) {
  function updateCountdown() {
    const end = new Date(t.content);
    const now = new Date();
    const diff = end - now;

    if (diff <= 0) {
      tile.innerHTML = "Time's up!";
      return;
    }

    const days = Math.floor(diff / (1000*60*60*24));
    const hours = Math.floor((diff / (1000*60*60)) % 24);
    const mins = Math.floor((diff / (1000*60)) % 60);
    const secs = Math.floor((diff / 1000) % 60);

    tile.innerHTML = `${days}d ${hours}h ${mins}m ${secs}s`;
  }
  updateCountdown();
  setInterval(updateCountdown, 1000);
}
else if (t.type === "youtube" && t.content) {
  const id = t.content.match(/(?:v=|youtu\.be\/)([^&]+)/)?.[1];
  if (id) {
    tile.innerHTML = `
      <iframe 
        src="https://www.youtube.com/embed/${id}?autoplay=1&mute=1&loop=1&playlist=${id}&controls=0&modestbranding=1"
        style="width:100%;height:100%;border:0;"
        allow="autoplay"
      ></iframe>`;
  }
}
else if (t.type === "timer" && t.content) {
  function updateTimer() {
    const start = new Date(t.content);
    const now = new Date();
    const diff = now - start;

    const days  = Math.floor(diff / (1000*60*60*24));
    const hours = Math.floor((diff / (1000*60*60)) % 24);
    const mins  = Math.floor((diff / (1000*60)) % 60);
    const secs  = Math.floor((diff / 1000) % 60);

    tile.innerHTML = `${days}d ${hours}h ${mins}m ${secs}s`;
  }
  updateTimer();
  setInterval(updateTimer, 1000);
}
else if (t.type === "weather_detailed" && t.content) {
  fetch(`https://wttr.in/${encodeURIComponent(t.content)}?format=j1`)
    .then(r => r.json())
    .then(w => {
      const now = w.current_condition[0];
      tile.innerHTML = `
        ${now.temp_F}°F<br>
        ${now.weatherDesc[0].value}<br>
        Wind ${now.windspeedMiles} mph<br>
        Humidity ${now.humidity}%<br>
      `;
    })
    .catch(() => tile.innerHTML = "Weather unavailable");
}
else if (t.type === "stock" && t.content) {
  fetch(`https://api.finage.co.uk/last/stock/${t.content}?apikey=demo`)
    .then(r => r.json())
    .then(s => { tile.innerHTML = `${t.content}: $${s.price}`; })
    .catch(() => tile.innerHTML = "Stock error");
}
else if (t.type === "crypto" && t.content) {
  fetch(`https://api.coinbase.com/v2/prices/${t.content}-USD/spot`)
    .then(r => r.json())
    .then(s => tile.innerHTML = `${t.content}: $${s.data.amount}`)
    .catch(() => tile.innerHTML = "Crypto unavailable");
}
else if (t.type === "audio" && t.content) {
  tile.innerHTML = `
    <audio autoplay loop style="width:100%;">
      <source src="${t.content}">
    </audio>`;
}
else if (t.type === "qrcode" && t.content) {
  tile.innerHTML = `
    <img src="https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=${encodeURIComponent(t.content)}">
  `;
}
else if (t.type === "map" && t.content) {
  tile.innerHTML = `
    <iframe 
      width="100%" height="100%" 
      style="border:0;"
      src="https://www.google.com/maps?q=${encodeURIComponent(t.content)}&output=embed">
    </iframe>`;
}
else if (t.type === "map" && t.content) {
  tile.innerHTML = `
    <iframe 
      width="100%" height="100%" 
      style="border:0;"
      src="https://www.google.com/maps?q=${encodeURIComponent(t.content)}&output=embed">
    </iframe>`;
}
else if (t.type === "marquee" && t.content) {
  tile.innerHTML = `<div class="marquee">${t.content}</div>`;
}
else if (t.type === "gradient" && t.content) {
  const [c1,c2] = t.content.split(",");
  tile.style.background = `linear-gradient(135deg, ${c1}, ${c2})`;
}

          container.appendChild(tile);
        });

      } catch (e) {
        console.error(e);
        document.getElementById("tilesContainer").innerHTML = `<div style="color:red;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:32px">Error: ${e.message}</div>`;
      }
    }

    loadTiles();
    setInterval(loadTiles, 8000);
  </script>
</body>
</html>
