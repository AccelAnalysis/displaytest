<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Remote Display</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      font-family: system-ui, sans-serif;
      color: white;
      background-image: url("./background.jpg");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 0;
    }
    .content {
      position: relative;
      z-index: 1;
      padding: 6vh 6vw;
      text-shadow: 0 2px 8px rgba(0,0,0,0.8);
    }
  </style>
</head>
<body id="pageBody">
  <!-- Direct video background (for MP4/etc.) -->
  <video id="bgVideo" autoplay muted loop playsinline
         style="position:fixed; top:0; left:0; width:100%; height:100%; object-fit:cover; z-index:-2; display:none;">
  </video>

  <!-- Vimeo iframe container (new) -->
  <div id="vimeoContainer" style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:-2; display:none; overflow:hidden;">
    <iframe id="vimeoPlayer" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen style="position:absolute; top:0; left:0; width:100%; height:100%;"></iframe>
  </div>

  <div class="overlay"></div>
  
  <div class="content">
    <div id="headline" style="font-size:48px; font-weight:700;"></div>
    <div id="subhead" style="font-size:28px; margin-top:10px;"></div>
    <div id="status" style="font-size:24px; margin-top:18px; color:crimson;"></div>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxPQCmFSUG_9W2N62hqo7tPI6M_T9GCFD2FveCnA8uOYZ0lHLmSNMQDIufXP03vmybZfg/exec";

    async function refreshDisplay() {
      try {
        const res = await fetch(API_URL, { cache: "no-store" });
        const data = await res.json();

        // Text content
        document.getElementById("headline").textContent = data.headline || "";
        document.getElementById("subhead").textContent  = data.subhead  || "";
        document.getElementById("status").textContent   = data.status   || "";

        const body         = document.getElementById("pageBody");
        const bgVideo      = document.getElementById("bgVideo");
        const vimeoContain = document.getElementById("vimeoContainer");
        const vimeoPlayer  = document.getElementById("vimeoPlayer");

        // 1. Direct video file (.mp4, etc.) → use <video> tag
        if (data.videoUrl && typeof data.videoUrl === "string" && data.videoUrl.match(/\.(mp4|webm|ogg|m4v|mov)($|\?)/i)) {
          body.style.backgroundImage = "none";
          vimeoContain.style.display = "none";
          bgVideo.src = data.videoUrl;
          bgVideo.style.display = "block";
          return;
        }

        // 2. Vimeo URL → use iframe embed (extract ID and build params)
        if (data.videoUrl && typeof data.videoUrl === "string" && data.videoUrl.includes('vimeo.com') && data.videoUrl.includes('/video/')) {
          const videoMatch = data.videoUrl.match(/\/video\/(\d+)/);
          if (videoMatch) {
            const videoId = videoMatch[1];
            body.style.backgroundImage = "none";
            bgVideo.style.display = "none";
            vimeoPlayer.src = `https://player.vimeo.com/video/${videoId}?autoplay=1&loop=1&muted=1&background=1&title=0&byline=0&portrait=0`;
            vimeoContain.style.display = "block";
            return;
          }
        }

        // 3. No video → static background
        bgVideo.style.display = "none";
        vimeoContain.style.display = "none";
        vimeoPlayer.src = "";
        if (data.bgUrl && typeof data.bgUrl === "string" && data.bgUrl.trim()) {
          body.style.backgroundImage = `url('${data.bgUrl.trim()}')`;
        } else {
          body.style.backgroundImage = "url('./background.jpg')";
        }
        body.style.backgroundSize = "cover";
        body.style.backgroundPosition = "center";
        body.style.backgroundRepeat = "no-repeat";

      } catch (err) {
        console.error("Display refresh failed", err);
      }
    }

    refreshDisplay();
    setInterval(refreshDisplay, 5000);
  </script>
</body>
</html>
