<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Flexible Tile Display</title>
  <style>
    body,html{margin:0;height:100vh;overflow:hidden;background:#000;font-family:system-ui,sans-serif}
    #tilesContainer{position:relative;width:100%;height:100%}
    .tile{
      position:absolute;
      box-sizing:border-box;
      overflow:hidden;
      user-select:none;
      transition:all 0.6s ease;
    }
    .tile img,.tile video,.tile iframe{width:100%;height:100%;object-fit:cover;display:block}
    .tile video{background:#000}
  </style>
</head>
<body>

<div id="tilesContainer"></div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbxPQCmFSUG_9W2N62hqo7tPI6M_T9GCFD2FveCnA8uOYZ0lHLmSNMQDIufXP03vmybZfg/exec";

  async function loadTiles() {
    try {
      const res = await fetch(API_URL + "?t=" + Date.now());
      const tiles = await res.json();

      const container = document.getElementById("tilesContainer");
      container.innerHTML = "";  // clear old tiles

      tiles.forEach(t => {
        if (!t.visible || t.visible === "FALSE") return;

        const tile = document.createElement("div");
        tile.className = "tile";

        // Position & size (you can use % or px)
        tile.style.left   = t.x || "0%";
        tile.style.top    = t.y || "0%";
        tile.style.width  = t.width || "30%";
        tile.style.height = t.height || "20%";

        // Photoshop-like styling
        tile.style.background   = t.bgColor || "rgba(0,0,0,0.6)";
        tile.style.color         = t.textColor || "white";
        tile.style.fontSize      = t.fontSize || "24px";
        tile.style.fontWeight    = t.bold ? "bold" : "normal";
        tile.style.textAlign     = t.align || "center";
        tile.style.padding       = t.padding || "20px";
        tile.style.borderRadius  = t.radius || "20px";
        tile.style.boxShadow     = t.shadow || "0 8px 32px rgba(0,0,0,0.6)";
        tile.style.opacity       = t.opacity ?? 1;
        tile.style.transform     = t.rotate ? `rotate(${t.rotate}deg)` : "";
        tile.style.zIndex        = t.zIndex || "1";
        tile.style.display       = "flex";
        tile.style.alignItems    = "center";
        tile.style.justifyContent= "center";
        tile.style.textShadow    = "0 2px 8px rgba(0,0,0,0.8)";

        // Content types
        if (t.type === "text" && t.content) {
          tile.innerHTML = t.content.replace(/\\n/g, "<br>");
        }
        else if (t.type === "image" && t.content) {
          tile.innerHTML = `<img src="${t.content}" alt="">`;
        }
        else if (t.type === "video" && t.content) {
          const isDirect = t.content.match(/\.(mp4|webm|mov|ogg)/i);
          if (isDirect) {
            tile.innerHTML = `<video autoplay muted loop playsinline><source src="${t.content}"></video>`;
          } else if (t.content.includes("vimeo")) {
            const id = t.content.match(/vimeo.*\/(\d+)/)?.[1];
            if (id) {
              tile.innerHTML = `<iframe src="https://player.vimeo.com/video/${id}?autoplay=1&loop=1&muted=1&background=1&title=0&byline=0&portrait=0" 
                                       allow="autoplay; fullscreen" allowfullscreen></iframe>`;
            }
          }
        }
        else if (t.type === "clock") {
          tile.innerHTML = "<div id='liveClock' style='font-size:3em;font-weight:bold'></div>";
          setInterval(() => {
            document.getElementById("liveClock")?.innerText = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
          }, 1000);
        }

        container.appendChild(tile);
      });

    } catch (e) { console.error(e); }
  }

  loadTiles();
  setInterval(loadTiles, 8000);  // refresh every 8 seconds
</script>

</body>
</html>
